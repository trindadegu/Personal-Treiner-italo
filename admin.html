<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Painel de Administração - Italo Ruan Personal Trainer">
    <title>Painel de Administração - Italo Ruan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap');

        :root {
            --primary-color: #1e40af;
            --secondary-color: #059669;
            --danger-color: #dc2626;
            --warning-color: #f59e0b;
            --light-bg: #f8fafc;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-text: #0f172a;
            --light-text: #f8fafc;
            --gray-text: #475569;
            --border-color: #e2e8f0;
            --dark-border: #334155;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 12px 24px rgba(30, 64, 175, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --light-bg: var(--dark-bg);
            --dark-text: var(--light-text);
            --border-color: var(--dark-border);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark-text);
            background-color: var(--light-bg);
            line-height: 1.6;
            transition: var(--transition);
        }

        .admin-header {
            background: var(--light-bg);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary-color);
            transition: var(--transition);
        }

        .header-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-brand i {
            font-size: 1.5rem;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-logout {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-logout:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        .theme-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.6rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
        }

        .admin-container {
            display: flex;
            min-height: calc(100vh - 70px);
            width: 100%;
            margin: 0 auto;
        }

        .sidebar {
            width: 250px;
            background: var(--light-bg);
            border-right: 2px solid var(--border-color);
            padding: 1.5rem 0;
            position: fixed;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            z-index: 900;
            transition: var(--transition);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-item {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            text-align: left;
            cursor: pointer;
            color: var(--gray-text);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
            border-left: 3px solid transparent;
            font-size: 0.95rem;
        }

        .nav-item:hover {
            background: var(--border-color);
            color: var(--primary-color);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(30, 64, 175, 0.1), transparent);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .nav-item i {
            font-size: 1.1rem;
            min-width: 24px;
        }

        .main-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            min-width: 0;
            margin-left: 250px;
            transition: var(--transition);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            color: var(--dark-text);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #1e3a8a);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color), #047857);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(5, 150, 105, 0.2);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .treinos-container, .students-container, .edit-training-container, .progress-container, .settings-box {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .student-card {
            background: linear-gradient(135deg, var(--light-bg), var(--border-color));
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition);
        }

        .student-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-hover);
            transform: translateY(-5px);
        }

        .student-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 1rem;
        }

        .student-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--dark-text);
        }

        .student-card p {
            color: var(--gray-text);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .student-actions {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-action {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .days-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
        }

        .day-tab {
            flex-shrink: 0;
            padding: 0.75rem 1.25rem;
            border: 2px solid var(--border-color);
            background: var(--light-bg);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            color: var(--gray-text);
            font-size: 0.9rem;
        }

        .day-tab:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .day-tab.active {
            background: linear-gradient(135deg, var(--primary-color), #1e3a8a);
            color: white;
            border-color: var(--primary-color);
        }

        .training-editor {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .training-editor h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .focus-area-group {
            margin-bottom: 1.5rem;
        }

        .focus-area-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .focus-area-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light-bg);
            color: var(--dark-text);
        }

        .focus-area-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .exercises-editor {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .exercises-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            background: var(--light-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 600px;
        }
        
        .exercises-table th,
        .exercises-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--dark-text);
            font-size: 0.9rem;
        }
        
        .exercises-table th {
            background: var(--border-color);
            font-weight: 600;
            color: var(--dark-text);
            white-space: nowrap;
        }
        
        .exercises-table input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            background: var(--light-bg);
            color: var(--dark-text);
            font-size: 0.9rem;
        }
        
        .exercises-table input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .exercise-row {
            transition: background-color 0.2s ease;
        }
        
        .exercise-row:hover {
            background: var(--border-color);
        }
        
        .btn-remove-exercise {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }
        
        .btn-remove-exercise:hover {
            background: #b91c1c;
        }

        .editor-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .settings-box h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--dark-text);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light-bg);
            color: var(--dark-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .progress-card {
            background: linear-gradient(135deg, var(--light-bg), var(--border-color));
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
        }

        .progress-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .progress-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--dark-text);
        }

        .progress-details {
            font-size: 0.85rem;
            color: var(--gray-text);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .completed-exercise {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .pending-exercise {
            color: var(--gray-text);
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--gray-text);
        }

        .student-selector {
            margin-bottom: 1.5rem;
        }

        .student-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .student-selector select {
            width: 100%;
            max-width: 300px;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            background: var(--light-bg);
            color: var(--dark-text);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            border: 1px solid var(--border-color);
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            font-family: 'Poppins', sans-serif;
            color: var(--dark-text);
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-text);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            margin-bottom: 1rem;
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s ease-out;
            font-weight: 600;
            border-left: 4px solid;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .toast.success {
            border-left: 4px solid var(--secondary-color);
            color: var(--secondary-color);
        }

        .toast.error {
            border-left: 4px solid var(--danger-color);
            color: var(--danger-color);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .btn-menu-toggle {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
        }

        .btn-menu-toggle:hover {
            background: #1e3a8a;
        }

        /* Mobile First Approach */
        @media (max-width: 1200px) {
            .sidebar {
                width: 220px;
            }
            .main-content {
                margin-left: 220px;
                padding: 1.25rem;
            }
        }

        @media (max-width: 1024px) {
            .students-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
            }
            
            .settings-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .progress-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                padding: 1rem;
            }
            
            .header-brand {
                font-size: 1.1rem;
            }
            
            .header-brand i {
                font-size: 1.3rem;
            }
            
            .btn-menu-toggle {
                display: block;
            }

            .admin-container {
                flex-direction: column;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                border-right: none;
                border-bottom: 2px solid var(--border-color);
                padding: 0;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
                z-index: 999;
                background: var(--light-bg);
            }

            .sidebar.active {
                max-height: 400px;
                padding: 1rem 0;
            }

            .sidebar-nav {
                flex-direction: column;
                flex-wrap: nowrap;
            }

            .nav-item {
                padding: 0.75rem 1.5rem;
                border-left: 3px solid transparent;
                width: 100%;
                text-align: left;
                justify-content: flex-start;
                font-size: 0.9rem;
            }

            .nav-item i {
                display: inline-block;
                font-size: 1rem;
            }

            .header-info {
                gap: 0.75rem;
            }

            .btn-logout {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }

            .theme-toggle {
                padding: 0.5rem;
            }

            .students-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .student-card {
                padding: 1.25rem;
            }

            .student-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.25rem;
            }

            .settings-box {
                padding: 1.25rem;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .section-header h2 {
                font-size: 1.3rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
                padding: 0.75rem 1rem;
            }

            .editor-actions {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                padding: 1.25rem;
                margin: 1rem;
            }

            .training-editor {
                padding: 1.25rem;
            }

            .exercises-editor {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .exercises-table {
                font-size: 0.8rem;
            }
            
            .exercises-table th,
            .exercises-table td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            
            .exercises-table input {
                padding: 0.4rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0.75rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .treinos-container, .students-container, .edit-training-container, .progress-container, .settings-box {
                padding: 1rem;
            }
            
            .training-editor {
                padding: 1rem;
            }
            
            .exercises-editor {
                padding: 0.75rem;
            }
            
            .days-tabs {
                gap: 0.25rem;
            }
            
            .day-tab {
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }
            
            .student-card {
                padding: 1rem;
            }
            
            .progress-card {
                padding: 1rem;
            }
            
            .modal-content {
                padding: 1rem;
            }
            
            .btn {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 360px) {
            .header-brand {
                font-size: 1rem;
            }
            
            .header-brand i {
                font-size: 1.1rem;
            }
            
            .btn-logout span {
                display: none;
            }
            
            .btn-logout {
                padding: 0.5rem;
            }
            
            .theme-toggle {
                padding: 0.5rem;
            }
        }

        /* Scrollbar personalizado */
        .days-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .days-tabs::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 3px;
        }

        .days-tabs::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .days-tabs::-webkit-scrollbar-thumb:hover {
            background: #1e3a8a;
        }

        /* Melhorias para tabelas em mobile */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .exercises-table {
            margin-bottom: 0;
        }
        /* Estilo para o modal personalizado */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 1rem;
}

.modal-content-small {
    background: var(--light-bg);
    border-radius: 12px;
    padding: 1.5rem;
    max-width: 400px;
    width: 100%;
    box-shadow: var(--shadow-hover);
    animation: slideIn 0.3s ease;
}

    </style>
</head>

<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-container">
            <div class="header-brand">
                <i class="fas fa-dumbbell"></i>
                <span>Admin Panel</span>
            </div>
            <div class="header-info">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <button class="btn-menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="btn-logout" onclick="logoutAdmin()">
                    <i class="fas fa-sign-out-alt"></i> <span>Sair</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Container Principal -->
    <div class="admin-container">
        <!-- Sidebar (Menu Lateral) -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-item" onclick="switchTab('students')">
                    <i class="fas fa-users"></i> Alunos
                </button>
                <button class="nav-item" onclick="switchTab('edit-training')">
                    <i class="fas fa-edit"></i> Editar Treino Aluno
                </button>
                <button class="nav-item" onclick="switchTab('default-trainings')">
                    <i class="fas fa-clipboard-list"></i> Treinos Padrão
                </button>
                <button class="nav-item" onclick="switchTab('progress')">
                    <i class="fas fa-chart-line"></i> Progresso dos Alunos
                </button>
                <button class="nav-item" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> Configurações
                </button>
            </nav>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="main-content">
            <!-- Dashboard -->
            <section class="tab-content active" id="dashboard">
                <div class="section-header">
                    <h2>Dashboard</h2>
                </div>
                <div class="treinos-container">
                    <p>Bem-vindo ao Painel de Administração. Use o menu lateral para gerenciar alunos e treinos.</p>
                    <p>Total de Alunos Cadastrados: <strong id="totalStudents">0</strong></p>
                </div>
            </section>

            <!-- Alunos -->
            <section class="tab-content" id="students">
                <div class="section-header">
                    <h2>Gerenciar Alunos</h2>
                    <button class="btn btn-primary" onclick="openAddStudentModal()">
                        <i class="fas fa-user-plus"></i> Adicionar Aluno
                    </button>
                </div>
                <div class="students-container">
                    <div class="students-grid" id="studentsGrid">
                        <!-- Cards de Alunos serão injetados aqui -->
                    </div>
                </div>
            </section>

            <!-- Editar Treino Aluno -->
            <section class="tab-content" id="edit-training">
                <div class="section-header">
                    <h2>Editar Treino do Aluno</h2>
                </div>
                <div class="edit-training-container">
                    <div class="form-group">
                        <label for="studentToEditTraining">Selecione o Aluno:</label>
                        <select id="studentToEditTraining" class="form-input" onchange="loadStudentTraining(this.value)">
                            <option value="">-- Selecione um Aluno --</option>
                        </select>
                    </div>

                    <div id="trainingEditorContainer" style="display: none;">
                        <div class="days-tabs" id="daysTabs">
                            <!-- Abas de Dias serão injetadas aqui -->
                        </div>

                        <div class="training-editor">
                            <h3 id="currentDayTitle">Treino de Segunda</h3>
                            
                            <div class="focus-area-group">
                                <label for="focusArea">Área de Foco:</label>
                                <input type="text" id="focusArea" class="form-input" placeholder="Ex: PEITO + TRÍCEPS + OMBRO">
                            </div>

                            <div class="exercises-editor">
                                <h4>Exercícios:</h4>
                                
                                <div class="table-container">
                                    <table class="exercises-table">
                                        <thead>
                                            <tr>
                                                <th width="40%">Exercício</th>
                                                <th width="15%">Séries</th>
                                                <th width="15%">Repetições</th>
                                                <th width="25%">Link do Vídeo</th>
                                                <th width="5%"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="exercisesTableBody">
                                            <!-- Linhas de exercícios serão injetadas aqui -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <button class="btn btn-secondary" onclick="addExerciseRow()">
                                    <i class="fas fa-plus"></i> Adicionar Exercício
                                </button>
                            </div>

                            <div class="editor-actions" style="margin-top: 2rem;">
                                <button class="btn btn-primary" onclick="saveStudentTraining()">
                                    <i class="fas fa-save"></i> Salvar Treino
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Treinos Padrão -->
            <section class="tab-content" id="default-trainings">
                <div class="section-header">
                    <h2>Treinos Padrão</h2>
                    <button class="btn btn-primary" onclick="applyDefaultTrainingToAll()">
                        <i class="fas fa-users"></i> Aplicar a Todos os Alunos
                    </button>
                    <button class="btn btn-secondary" onclick="applyDefaultTrainingToSpecificStudent()">
    <i class="fas fa-user-check"></i> Aplicar a Aluno Específico
</button>

                </div>
                <div class="edit-training-container">
                    <div class="days-tabs" id="defaultDaysTabs">
                        <!-- Abas de Dias para treinos padrão -->
                    </div>

                    <div class="training-editor">
                        <h3 id="defaultCurrentDayTitle">Treino Padrão - Segunda</h3>
                        
                        <div class="focus-area-group">
                            <label for="defaultFocusArea">Área de Foco:</label>
                            <input type="text" id="defaultFocusArea" class="form-input" placeholder="Ex: PEITO + TRÍCEPS + OMBRO">
                        </div>

                        <div class="exercises-editor">
                            <h4>Exercícios:</h4>
                            
                            <div class="table-container">
                                <table class="exercises-table">
                                    <thead>
                                        <tr>
                                            <th width="40%">Exercício</th>
                                            <th width="15%">Séries</th>
                                            <th width="15%">Repetições</th>
                                            <th width="25%">Link do Vídeo</th>
                                            <th width="5%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="defaultExercisesTableBody">
                                        <!-- Linhas de exercícios padrão serão injetadas aqui -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <button class="btn btn-secondary" onclick="addDefaultExerciseRow()">
                                <i class="fas fa-plus"></i> Adicionar Exercício
                            </button>
                        </div>

                        <div class="editor-actions" style="margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="saveDefaultTraining()">
                                <i class="fas fa-save"></i> Salvar Treino Padrão
                            </button>
                            <button class="btn btn-warning" onclick="loadPredefinedTraining()">
                                <i class="fas fa-magic"></i> Carregar Treino Pré-definido
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progresso dos Alunos -->
            <section class="tab-content" id="progress">
                <div class="section-header">
                    <h2>Progresso dos Alunos</h2>
                </div>
                <div class="progress-container">
                    <div class="student-selector">
                        <label for="studentProgressSelect">Selecione o Aluno para ver o progresso:</label>
                        <select id="studentProgressSelect" class="form-input" onchange="loadStudentProgress(this.value)">
                            <option value="">-- Todos os Alunos --</option>
                        </select>
                    </div>
                    <div class="progress-grid" id="progressGrid">
                        <!-- Cards de progresso serão injetados aqui -->
                    </div>
                </div>
            </section>

            <!-- Configurações -->
            <section class="tab-content" id="settings">
                <div class="section-header">
                    <h2>Configurações</h2>
                </div>
                <div class="settings-container">
                    <div class="settings-box">
                        <h3>Credenciais de Admin</h3>
                        <div class="form-group">
                            <label for="adminUserSetting">Usuário:</label>
                            <input type="text" id="adminUserSetting" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label for="adminPasswordSetting">Nova Senha:</label>
                            <input type="password" id="adminPasswordSetting" class="form-input" placeholder="Deixe em branco para manter a atual">
                        </div>
                        <button class="btn btn-primary" onclick="saveAdminSettings()">
                            <i class="fas fa-save"></i> Salvar Configurações
                        </button>
                    </div>

                    <div class="settings-box">
                        <h3>Gerenciamento de Dados</h3>
                        <p>Exportar ou limpar todos os dados de alunos e treinos.</p>
                        <button class="btn btn-warning" onclick="exportData()">
                            <i class="fas fa-file-export"></i> Exportar Dados
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Modal Adicionar/Editar Aluno -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">Adicionar Aluno</h2>
                <button class="modal-close" onclick="closeModal('studentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="studentFormModal">
                    <input type="hidden" id="studentIdModal">
                    <div class="form-group">
                        <label for="studentNameModal">Nome do Aluno:</label>
                        <input type="text" id="studentNameModal" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="studentModalSubmit">Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ========================================
        // CONFIGURAÇÕES SUPABASE
        // ========================================

        const SUPABASE_URL = 'https://idwtktaypxsomnqlmjdp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlkd3RrdGF5cHhzb21ucWxtamRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2ODQ4NjIsImV4cCI6MjA4MTI2MDg2Mn0.NqqhknttW9VfIb4sr3NkpTRemV3_YohxK093Pjhm8v0';
        
        // Inicializar Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Configurações
        const THEME_KEY = 'appTheme';
        const ADMIN_CREDENTIALS = {
            user: 'italo',
            password: 'italoruan123'
        };

        let currentStudent = null;
        let currentDay = 'segunda';
        let currentDefaultTraining = null;

        // ========================================
        // FUNÇÕES SUPABASE
        // ========================================

        // ALUNOS
        async function getStudents() {
            try {
                const { data, error } = await supabase
                    .from('alunos')
                    .select('*')
                    .order('nome');
                
                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Erro ao buscar alunos:', error);
                showToast('Erro ao carregar alunos: ' + error.message, 'error');
                return [];
            }
        }

        async function saveStudent(aluno) {
            try {
                const { data, error } = await supabase
                    .from('alunos')
                    .upsert([aluno]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Erro ao salvar aluno:', error);
                throw error;
            }
        }

        async function deleteStudentFromSupabase(id) {
            try {
                const { error } = await supabase
                    .from('alunos')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                return true;
            } catch (error) {
                console.error('Erro ao deletar aluno:', error);
                throw error;
            }
        }

        // TREINOS
        async function getTraining(alunoId) {
            try {
                const { data, error } = await supabase
                    .from('treinos')
                    .select('*')
                    .eq('aluno_id', alunoId)
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        return initializeEmptyTraining();
                    }
                    throw error;
                }
                return data.treino || initializeEmptyTraining();
            } catch (error) {
                console.error('Erro ao buscar treino:', error);
                return initializeEmptyTraining();
            }
        }

        async function saveTraining(alunoId, treino) {
            try {
                const trainingData = {
                    aluno_id: alunoId,
                    treino: treino,
                    updated_at: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('treinos')
                    .upsert([trainingData], { onConflict: 'aluno_id' });
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Erro ao salvar treino:', error);
                throw error;
            }
        }

        function initializeEmptyTraining() {
            const days = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'];
            const newTraining = {};
            
            days.forEach(day => {
                newTraining[day] = {
                    focus: 'Nenhum foco definido',
                    exercises: []
                };
            });
            
            return newTraining;
        }

        // TREINOS PADRÃO
        async function getDefaultTraining() {
            try {
                const { data, error } = await supabase
                    .from('treinos_padroes')
                    .select('*')
                    .single();
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        return initializeDefaultTrainings();
                    }
                    throw error;
                }
                return data.treino || initializeDefaultTrainings();
            } catch (error) {
                console.error('Erro ao buscar treino padrão:', error);
                return initializeDefaultTrainings();
            }
        }

        async function saveDefaultTraining(treino) {
            try {
                const trainingData = {
                    treino: treino,
                    updated_at: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('treinos_padroes')
                    .upsert([trainingData]);
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Erro ao salvar treino padrão:', error);
                throw error;
            }
        }

        // PROGRESSO
        async function getProgress(alunoId = null) {
            try {
                let query = supabase
                    .from('progresso')
                    .select('*');
                
                if (alunoId) {
                    query = query.eq('aluno_id', alunoId);
                }

                const { data, error } = await query;
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        return alunoId ? { [alunoId]: {} } : {};
                    }
                    throw error;
                }

                // Formatar dados
                const progressMap = {};
                data.forEach(item => {
                    progressMap[item.aluno_id] = item.progresso || {};
                });

                return alunoId ? (progressMap[alunoId] || {}) : progressMap;
            } catch (error) {
                console.error('Erro ao buscar progresso:', error);
                return alunoId ? {} : {};
            }
        }

        async function saveProgress(alunoId, progresso) {
            try {
                const progressData = {
                    aluno_id: alunoId,
                    progresso: progresso,
                    updated_at: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('progresso')
                    .upsert([progressData], { onConflict: 'aluno_id' });
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Erro ao salvar progresso:', error);
                throw error;
            }
        }

        // ========================================
        // INICIALIZAÇÃO
        // ========================================

        document.addEventListener('DOMContentLoaded', async function() {
            loadTheme();
            await checkAdminLogin();
            await loadAdminCredentials();
            
            // Carregar dados iniciais
            await loadStudents();
            await loadStudentsForTrainingEdit();
            await loadStudentsForProgress();
            setupDaysTabs();
            await initializeDefaultTrainingsTab();
            
            switchTab('dashboard');
        });

        // ========================================
        // GERENCIAMENTO DE TEMA
        // ========================================

        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const themeIcon = document.getElementById('themeIcon');
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
            localStorage.setItem(THEME_KEY, theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        // ========================================
        // ADMIN LOGIN
        // ========================================

        async function checkAdminLogin() {
            const adminSession = localStorage.getItem('admin_session');
            if (!adminSession) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const session = JSON.parse(adminSession);
                const currentTime = new Date().getTime();
                
                if (session.expiresAt < currentTime) {
                    localStorage.removeItem('admin_session');
                    window.location.href = 'login.html';
                }
            } catch (error) {
                localStorage.removeItem('admin_session');
                window.location.href = 'login.html';
            }
        }

        function logoutAdmin() {
            localStorage.removeItem('admin_session');
            window.location.href = 'login.html';
        }

        async function loadAdminCredentials() {
            try {
                const { data, error } = await supabase
                    .from('admins')
                    .select('*')
                    .eq('username', 'italo')
                    .single();

                if (!error && data) {
                    document.getElementById('adminUserSetting').value = data.username;
                } else {
                    document.getElementById('adminUserSetting').value = 'italo';
                }
            } catch (error) {
                document.getElementById('adminUserSetting').value = 'italo';
            }
        }

        async function saveAdminSettings() {
            const newPassword = document.getElementById('adminPasswordSetting').value.trim();
            
            if (newPassword) {
                try {
                    await supabase
                        .from('admins')
                        .upsert([
                            {
                                username: 'italo',
                                password: newPassword,
                                updated_at: new Date().toISOString()
                            }
                        ]);

                    showToast('Senha de Admin alterada com sucesso!', 'success');
                    document.getElementById('adminPasswordSetting').value = '';
                } catch (error) {
                    showToast('Erro ao salvar senha: ' + error.message, 'error');
                }
            } else {
                showToast('Digite uma nova senha para alterar', 'error');
            }
        }

        // ========================================
        // NAVEGAÇÃO DE TABS
        // ========================================

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        async function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // Fechar o menu em mobile após a seleção
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('active');
            }

            if (tabName === 'students') {
                await loadStudents();
            } else if (tabName === 'dashboard') {
                const students = await getStudents();
                document.getElementById('totalStudents').textContent = students.length;
            } else if (tabName === 'progress') {
                await loadProgressOverview();
            } else if (tabName === 'default-trainings') {
                await initializeDefaultTrainingsTab();
            }
        }

        // ========================================
        // GERENCIAMENTO DE ALUNOS
        // ========================================

        async function loadStudents() {
            try {
                const students = await getStudents();
                const studentsGrid = document.getElementById('studentsGrid');
                studentsGrid.innerHTML = '';

                if (students.length === 0) {
                    studentsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray-text);">Nenhum aluno cadastrado.</p>';
                    return;
                }

                students.forEach(student => {
                    const card = document.createElement('div');
                    card.className = 'student-card';
                    card.innerHTML = `
                        <div class="student-avatar">${student.nome.charAt(0).toUpperCase()}</div>
                        <h4>${student.nome}</h4>
                        <p>ID: ${student.id}</p>
                        <p style="font-size: 0.9rem; color: var(--secondary-color); margin-bottom: 1rem;">Senha: ${student.id.toString().slice(-6)}</p>
                        <div class="student-actions">
                            <button class="btn btn-danger btn-action" onclick="deleteStudentHandler('${student.id}')">
                                <i class="fas fa-trash-alt"></i> Excluir
                            </button>
                        </div>
                    `;
                    studentsGrid.appendChild(card);
                });
                
                await loadStudentsForTrainingEdit();
                await loadStudentsForProgress();
                document.getElementById('totalStudents').textContent = students.length;
            } catch (error) {
                showToast('Erro ao carregar alunos: ' + error.message, 'error');
            }
        }

        function openAddStudentModal() {
            document.getElementById('studentModalTitle').textContent = 'Adicionar Novo Aluno';
            document.getElementById('studentIdModal').value = '';
            document.getElementById('studentNameModal').value = '';
            document.getElementById('studentModalSubmit').textContent = 'Salvar Aluno';
            document.getElementById('studentFormModal').onsubmit = saveNewStudent;
            openModal('studentModal');
        }

        async function saveNewStudent(event) {
            event.preventDefault();
            const name = document.getElementById('studentNameModal').value.trim();
            
            if (!name) {
                showToast('Digite o nome do aluno', 'error');
                return;
            }

            try {
                // Gerar ID único
                const newId = 'aluno_' + Date.now().toString();
                
                const newStudent = {
                    id: newId,
                    nome: name,
                    created_at: new Date().toISOString()
                };

                await saveStudent(newStudent);
                
                // Inicializar treino vazio para o novo aluno
                await saveTraining(newId, initializeEmptyTraining());

                await loadStudents();
                closeModal('studentModal');
                showToast(`Aluno adicionado com sucesso! ID: ${newId} - Senha: ${newId.slice(-6)}`, 'success');
            } catch (error) {
                showToast('Erro ao adicionar aluno: ' + error.message, 'error');
            }
        }

        async function deleteStudentHandler(id) {
            if (confirm('Tem certeza que deseja excluir este aluno e todos os seus dados de treino?')) {
                try {
                    await deleteStudentFromSupabase(id);
                    
                    // Deletar também treinos e progresso associados
                    await supabase.from('treinos').delete().eq('aluno_id', id);
                    await supabase.from('progresso').delete().eq('aluno_id', id);
                    
                    await loadStudents();
                    showToast('Aluno excluído com sucesso!', 'success');
                } catch (error) {
                    showToast('Erro ao excluir aluno: ' + error.message, 'error');
                }
            }
        }

        // ========================================
        // EDIÇÃO DE TREINO POR ALUNO
        // ========================================

        async function loadStudentsForTrainingEdit() {
            try {
                const students = await getStudents();
                const select = document.getElementById('studentToEditTraining');
                const currentSelected = select.value;
                
                select.innerHTML = '<option value="">-- Selecione um Aluno --</option>';
                
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.nome;
                    select.appendChild(option);
                });
                
                // Tenta manter o aluno selecionado
                if (currentSelected && students.some(s => s.id === currentSelected)) {
                    select.value = currentSelected;
                    await loadStudentTraining(currentSelected);
                } else {
                    document.getElementById('trainingEditorContainer').style.display = 'none';
                }
            } catch (error) {
                console.error('Erro ao carregar alunos para edição:', error);
            }
        }

        async function loadStudentsForProgress() {
            try {
                const students = await getStudents();
                const select = document.getElementById('studentProgressSelect');
                
                select.innerHTML = '<option value="">-- Todos os Alunos --</option>';
                
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.nome;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Erro ao carregar alunos para progresso:', error);
            }
        }

        function setupDaysTabs() {
            const days = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'];
            const tabsContainer = document.getElementById('daysTabs');
            tabsContainer.innerHTML = '';

            days.forEach(day => {
                const button = document.createElement('button');
                button.className = 'day-tab';
                button.textContent = day.charAt(0).toUpperCase() + day.slice(1);
                button.onclick = () => selectDayToEdit(day);
                tabsContainer.appendChild(button);
            });
        }

        async function loadStudentTraining(studentId) {
            currentStudent = studentId;
            const container = document.getElementById('trainingEditorContainer');
            
            if (!studentId) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            await selectDayToEdit(currentDay);
        }

        async function selectDayToEdit(day) {
            currentDay = day;
            
            document.querySelectorAll('.day-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            const dayIndex = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'].indexOf(day);
            if (dayIndex >= 0) {
                document.querySelector(`#daysTabs button:nth-child(${dayIndex + 1})`).classList.add('active');
            }
            
            document.getElementById('currentDayTitle').textContent = 'Treino de ' + day.charAt(0).toUpperCase() + day.slice(1);
            
            await loadDayTraining();
        }

        async function loadDayTraining() {
            if (!currentStudent) return;

            try {
                const training = await getTraining(currentStudent);
                const dayTraining = training[currentDay];
                
                if (!dayTraining) {
                    // Inicializar treino vazio
                    training[currentDay] = {
                        focus: '',
                        exercises: []
                    };
                    await saveTraining(currentStudent, training);
                    await loadDayTraining();
                    return;
                }

                document.getElementById('focusArea').value = dayTraining.focus || '';
                loadExercisesToTable(dayTraining.exercises || []);
            } catch (error) {
                showToast('Erro ao carregar treino: ' + error.message, 'error');
            }
        }

        // ========================================
        // FUNÇÕES PARA GERENCIAR EXERCÍCIOS EM TABELA
        // ========================================

        function addExerciseRow() {
            const tbody = document.getElementById('exercisesTableBody');
            const row = document.createElement('tr');
            row.className = 'exercise-row';
            row.innerHTML = `
                <td>
                    <input type="text" class="exercise-name" placeholder="Ex: Supino reto com halteres" required>
                </td>
                <td>
                    <input type="text" class="exercise-series" placeholder="Ex: 4" required>
                </td>
                <td>
                    <input type="text" class="exercise-reps" placeholder="Ex: 20-15-12-10" required>
                </td>
                <td>
                    <input type="text" class="exercise-video" placeholder="https://youtube.com/...">
                </td>
                <td>
                    <button type="button" class="btn-remove-exercise" onclick="removeExerciseRow(this)">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        }

        function removeExerciseRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        function loadExercisesToTable(exercises) {
            const tbody = document.getElementById('exercisesTableBody');
            tbody.innerHTML = '';

            if (exercises && exercises.length > 0) {
                exercises.forEach(exercise => {
                    const row = document.createElement('tr');
                    row.className = 'exercise-row';
                    row.innerHTML = `
                        <td>
                            <input type="text" class="exercise-name" value="${exercise.name || ''}" placeholder="Ex: Supino reto com halteres" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-series" value="${exercise.series || ''}" placeholder="Ex: 4" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-reps" value="${exercise.reps || ''}" placeholder="Ex: 20-15-12-10" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-video" value="${exercise.video || ''}" placeholder="https://youtube.com/...">
                        </td>
                        <td>
                            <button type="button" class="btn-remove-exercise" onclick="removeExerciseRow(this)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                addExerciseRow();
            }
        }

        function getExercisesFromTable() {
            const exercises = [];
            const rows = document.querySelectorAll('#exercisesTableBody .exercise-row');
            
            rows.forEach(row => {
                const name = row.querySelector('.exercise-name').value.trim();
                const series = row.querySelector('.exercise-series').value.trim();
                const reps = row.querySelector('.exercise-reps').value.trim();
                const video = row.querySelector('.exercise-video').value.trim();
                
                if (name && series && reps) {
                    exercises.push({
                        name: name,
                        series: series,
                        reps: reps,
                        video: video
                    });
                }
            });
            
            return exercises;
        }

        async function saveStudentTraining() {
            if (!currentStudent) {
                showToast('Selecione um aluno primeiro', 'error');
                return;
            }

            try {
                const currentTraining = await getTraining(currentStudent);
                
                currentTraining[currentDay] = {
                    focus: document.getElementById('focusArea').value.trim(),
                    exercises: getExercisesFromTable()
                };

                await saveTraining(currentStudent, currentTraining);
                showToast(`Treino de ${currentDay} salvo com sucesso para o aluno!`, 'success');
            } catch (error) {
                showToast('Erro ao salvar treino: ' + error.message, 'error');
            }
        }

        // ========================================
        // TREINOS PADRÃO
        // ========================================

        // ========================================
// APLICAR TREINO PADRÃO A ALUNO ESPECÍFICO
// ========================================

async function applyDefaultTrainingToSpecificStudent() {
    try {
        // Carregar alunos
        const students = await getStudents();
        if (students.length === 0) {
            showToast('Nenhum aluno cadastrado!', 'error');
            return;
        }

        // Criar modal para seleção
        const modalContent = `
            <div class="modal-header">
                <h2>Aplicar Treino Padrão a Aluno Específico</h2>
                <button class="modal-close" onclick="closeModal('customModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="specificStudentSelect">Selecione o aluno:</label>
                    <select id="specificStudentSelect" class="form-input">
                        ${students.map(student => 
                            `<option value="${student.id}">${student.nome}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="replaceExisting" checked>
                        Substituir treino atual do aluno
                    </label>
                </div>
                <button class="btn btn-primary" onclick="confirmApplyToSpecificStudent()">
                    <i class="fas fa-user-check"></i> Aplicar Treino
                </button>
            </div>
        `;

        // Criar ou atualizar modal
        let modal = document.getElementById('customModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'customModal';
            modal.className = 'modal';
            modal.innerHTML = `<div class="modal-content">${modalContent}</div>`;
            document.body.appendChild(modal);
        } else {
            modal.querySelector('.modal-content').innerHTML = modalContent;
        }

        openModal('customModal');
    } catch (error) {
        showToast('Erro ao carregar alunos: ' + error.message, 'error');
    }
}

async function confirmApplyToSpecificStudent() {
    try {
        const studentId = document.getElementById('specificStudentSelect').value;
        const replaceExisting = document.getElementById('replaceExisting').checked;
        const defaultTraining = await getDefaultTraining();

        if (!studentId) {
            showToast('Selecione um aluno!', 'error');
            return;
        }

        let currentTraining = {};
        if (!replaceExisting) {
            // Manter treino existente, apenas complementar
            currentTraining = await getTraining(studentId);
        }

        // Mesclar ou substituir treinos
        const finalTraining = replaceExisting 
            ? defaultTraining 
            : { ...currentTraining, ...defaultTraining };

        // Salvar treino
        await saveTraining(studentId, finalTraining);
        
        closeModal('customModal');
        showToast('Treino padrão aplicado ao aluno com sucesso!', 'success');
        
        // Se o aluno atual estiver selecionado, atualizar a visualização
        if (currentStudent === studentId) {
            await loadStudentTraining(studentId);
        }
    } catch (error) {
        showToast('Erro ao aplicar treino: ' + error.message, 'error');
    }
}

        async function initializeDefaultTrainingsTab() {
            setupDefaultDaysTabs();
            await loadDefaultTraining();
        }

        function setupDefaultDaysTabs() {
            const days = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'];
            const tabsContainer = document.getElementById('defaultDaysTabs');
            tabsContainer.innerHTML = '';

            days.forEach(day => {
                const button = document.createElement('button');
                button.className = 'day-tab';
                button.textContent = day.charAt(0).toUpperCase() + day.slice(1);
                button.onclick = () => selectDefaultDayToEdit(day);
                tabsContainer.appendChild(button);
            });
        }

        function selectDefaultDayToEdit(day) {
            currentDay = day;
            
            document.querySelectorAll('#defaultDaysTabs .day-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            const dayIndex = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'].indexOf(day);
            if (dayIndex >= 0) {
                document.querySelector(`#defaultDaysTabs button:nth-child(${dayIndex + 1})`).classList.add('active');
            }
            
            document.getElementById('defaultCurrentDayTitle').textContent = 'Treino Padrão - ' + day.charAt(0).toUpperCase() + day.slice(1);
            
            loadDefaultTraining();
        }

        async function loadDefaultTraining() {
            try {
                currentDefaultTraining = await getDefaultTraining();
                const dayTraining = currentDefaultTraining[currentDay];
                
                if (!dayTraining) {
                    // Inicializar treino padrão vazio
                    currentDefaultTraining[currentDay] = {
                        focus: '',
                        exercises: []
                    };
                    await saveDefaultTraining(currentDefaultTraining);
                    await loadDefaultTraining();
                    return;
                }

                document.getElementById('defaultFocusArea').value = dayTraining.focus || '';
                loadDefaultExercisesToTable(dayTraining.exercises || []);
            } catch (error) {
                showToast('Erro ao carregar treino padrão: ' + error.message, 'error');
            }
        }

        function initializeDefaultTrainings() {
            const defaultTrainings = {
                segunda: {
                    focus: 'PEITO + TRÍCEPS + OMBRO',
                    exercises: [
                        { name: 'Supino reto com halteres', series: '4', reps: '20-15-12-10', video: '' },
                        { name: 'Supino inclinado com halteres', series: '4', reps: '10', video: '' },
                        { name: 'Crucifixo no banco inclinado', series: '4', reps: '10', video: '' },
                        { name: 'Crucifixo polia', series: '4', reps: '10', video: '' },
                        { name: 'Elevação lateral com halteres', series: '4', reps: '10', video: '' },
                        { name: 'Remada alta com barra', series: '4', reps: '10', video: '' },
                        { name: 'Elevação frontal com corda na polia', series: '3', reps: '15', video: '' },
                        { name: 'Tríceps na polia', series: '4', reps: '10', video: '' },
                        { name: 'Tríceps patada', series: '4', reps: '15', video: '' }
                    ]
                },
                terca: {
                    focus: 'PERNAS - QUADRÍCEPS',
                    exercises: [
                        { name: 'Agachamento sumô (mobilidade)', series: '2', reps: '20 segundos', video: '' },
                        { name: 'Mobilidade de tornozelo e quadril', series: '2', reps: '10/lado', video: '' },
                        { name: 'Cadeira extensora', series: '4', reps: '20', video: '' },
                        { name: 'Agachamento livre com barra', series: '4', reps: '10', video: '' },
                        { name: 'Leg press 45', series: '4', reps: '10', video: '' },
                        { name: 'Agachamento afundo com halteres', series: '4', reps: '10', video: '' },
                        { name: 'Cadeira flexora', series: '4', reps: '20-15-12-10', video: '' },
                        { name: 'Cadeira adutora', series: '3', reps: '20', video: '' },
                        { name: 'Panturrilha máquina', series: '3', reps: '15', video: '' }
                    ]
                },
                quarta: {
                    focus: 'COSTAS + POST. OMBRO, BÍCEPS',
                    exercises: [
                        { name: 'Puxada pela fren. com pegada aberta', series: '4', reps: '20-15-12-10', video: '' },
                        { name: 'Puxada pela fren. com pegada supinada', series: '3', reps: '10', video: '' },
                        { name: 'Remada curvada com barra', series: '4', reps: '10', video: '' },
                        { name: 'Remada curvada com halteres', series: '3', reps: '10', video: '' },
                        { name: 'Pulldown polia alta', series: '3', reps: '10', video: '' },
                        { name: 'Remada baixa na polia (use a barra)', series: '3', reps: '10', video: '' },
                        { name: 'Encolhimento de ombro', series: '3', reps: '10', video: '' },
                        { name: 'Rosca direta com barra', series: '4', reps: '10', video: '' },
                        { name: 'Rosca Scott com barra W', series: '4', reps: '10', video: '' }
                    ]
                },
                quinta: {
                    focus: 'PERNAS GLÚTEOS',
                    exercises: [
                        { name: 'Agachamento sumô (mobilidade)', series: '2', reps: '20 segundos', video: '' },
                        { name: 'Mobilidade de tornozelo e quadril', series: '2', reps: '10/lado', video: '' },
                        { name: 'Cadeira adutora', series: '3', reps: '20', video: '' },
                        { name: 'Levantamento terra com barra', series: '4', reps: '10', video: '' },
                        { name: 'Mesa flexora bilateral', series: '3', reps: '10', video: '' },
                        { name: 'Elevação pélvica', series: '4', reps: '10', video: '' },
                        { name: 'Cadeira flexora', series: '4', reps: '20-15-12-10', video: '' },
                        { name: 'Stiff joelho flexionado com halteres', series: '4', reps: '10', video: '' },
                        { name: 'Cadeira extensoura', series: '4', reps: '20', video: '' }
                    ]
                },
                sexta: {
                    focus: 'OMBRO COMPLETO',
                    exercises: [
                        { name: 'Desenvolvimento máquina', series: '4', reps: '10', video: '' },
                        { name: 'Desenvolvimento Arnold', series: '4', reps: '10', video: '' },
                        { name: 'Elevação lateral sentado/rest-pause na última série', series: '4', reps: '10', video: '' },
                        { name: 'Voador inversor com pegada pronada (use o rest-pause)', series: '4', reps: '10', video: '' },
                        { name: 'Elevação frontal com corda na polia (drop-set na última série)', series: '4', reps: '10', video: '' },
                        { name: 'Remada com corda na polia alta', series: '4', reps: '10', video: '' },
                        { name: 'Encolhimento de ombro', series: '4', reps: '10', video: '' }
                    ]
                }
            };
            
            return defaultTrainings;
        }

        async function loadPredefinedTraining() {
            if (confirm('Carregar treino pré-definido? Isso substituirá o treino atual deste dia.')) {
                try {
                    const defaultTraining = initializeDefaultTrainings();
                    currentDefaultTraining = defaultTraining;
                    await saveDefaultTraining(defaultTraining);
                    await loadDefaultTraining();
                    showToast('Treino pré-definido carregado com sucesso!', 'success');
                } catch (error) {
                    showToast('Erro ao carregar treino pré-definido: ' + error.message, 'error');
                }
            }
        }

        function addDefaultExerciseRow() {
            const tbody = document.getElementById('defaultExercisesTableBody');
            const row = document.createElement('tr');
            row.className = 'exercise-row';
            row.innerHTML = `
                <td>
                    <input type="text" class="exercise-name" placeholder="Ex: Supino reto com halteres" required>
                </td>
                <td>
                    <input type="text" class="exercise-series" placeholder="Ex: 4" required>
                </td>
                <td>
                    <input type="text" class="exercise-reps" placeholder="Ex: 20-15-12-10" required>
                </td>
                <td>
                    <input type="text" class="exercise-video" placeholder="https://youtube.com/...">
                </td>
                <td>
                    <button type="button" class="btn-remove-exercise" onclick="removeDefaultExerciseRow(this)">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        }

        function removeDefaultExerciseRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        function loadDefaultExercisesToTable(exercises) {
            const tbody = document.getElementById('defaultExercisesTableBody');
            tbody.innerHTML = '';

            if (exercises && exercises.length > 0) {
                exercises.forEach(exercise => {
                    const row = document.createElement('tr');
                    row.className = 'exercise-row';
                    row.innerHTML = `
                        <td>
                            <input type="text" class="exercise-name" value="${exercise.name || ''}" placeholder="Ex: Supino reto com halteres" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-series" value="${exercise.series || ''}" placeholder="Ex: 4" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-reps" value="${exercise.reps || ''}" placeholder="Ex: 20-15-12-10" required>
                        </td>
                        <td>
                            <input type="text" class="exercise-video" value="${exercise.video || ''}" placeholder="https://youtube.com/...">
                        </td>
                        <td>
                            <button type="button" class="btn-remove-exercise" onclick="removeDefaultExerciseRow(this)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                addDefaultExerciseRow();
            }
        }

        function getDefaultExercisesFromTable() {
            const exercises = [];
            const rows = document.querySelectorAll('#defaultExercisesTableBody .exercise-row');
            
            rows.forEach(row => {
                const name = row.querySelector('.exercise-name').value.trim();
                const series = row.querySelector('.exercise-series').value.trim();
                const reps = row.querySelector('.exercise-reps').value.trim();
                const video = row.querySelector('.exercise-video').value.trim();
                
                if (name && series && reps) {
                    exercises.push({
                        name: name,
                        series: series,
                        reps: reps,
                        video: video
                    });
                }
            });
            
            return exercises;
        }

        async function saveDefaultTraining() {
            try {
                if (!currentDefaultTraining) {
                    currentDefaultTraining = {};
                }
                
                currentDefaultTraining[currentDay] = {
                    focus: document.getElementById('defaultFocusArea').value.trim(),
                    exercises: getDefaultExercisesFromTable()
                };
                
                await saveDefaultTraining(currentDefaultTraining);
                showToast(`Treino padrão de ${currentDay} salvo com sucesso!`, 'success');
            } catch (error) {
                showToast('Erro ao salvar treino padrão: ' + error.message, 'error');
            }
        }

        async function applyDefaultTrainingToAll() {
            if (confirm('Aplicar treino padrão atual a TODOS os alunos? Isso substituirá os treinos existentes.')) {
                try {
                    const defaultTraining = await getDefaultTraining();
                    const students = await getStudents();
                    
                    for (const student of students) {
                        await saveTraining(student.id, defaultTraining);
                    }
                    
                    showToast(`Treino padrão aplicado a ${students.length} aluno(s) com sucesso!`, 'success');
                } catch (error) {
                    showToast('Erro ao aplicar treino padrão: ' + error.message, 'error');
                }
            }
        }

        // ========================================
        // MONITORAMENTO DE PROGRESSO
        // ========================================

        async function loadStudentProgress(studentId) {
            await loadProgressOverview(studentId);
        }

        async function loadProgressOverview(selectedStudentId = null) {
            try {
                const students = await getStudents();
                const progressGrid = document.getElementById('progressGrid');
                progressGrid.innerHTML = '';

                if (students.length === 0) {
                    progressGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray-text);">Nenhum aluno cadastrado.</p>';
                    return;
                }

                const studentsToShow = selectedStudentId 
                    ? students.filter(s => s.id === selectedStudentId)
                    : students;

                if (studentsToShow.length === 0) {
                    progressGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray-text);">Nenhum aluno selecionado.</p>';
                    return;
                }

                for (const student of studentsToShow) {
                    const studentTrainings = await getTraining(student.id);
                    const studentProgress = await getProgress(student.id);
                    
                    let totalExercises = 0;
                    let completedExercises = 0;
                    let progressByDay = {};

                    // Calcular estatísticas
                    Object.keys(studentTrainings).forEach(day => {
                        const dayTraining = studentTrainings[day];
                        const dayProgress = studentProgress[day] || [];
                        
                        if (dayTraining && dayTraining.exercises) {
                            totalExercises += dayTraining.exercises.length;
                            completedExercises += dayProgress.length;
                            
                            progressByDay[day] = {
                                total: dayTraining.exercises.length,
                                completed: dayProgress.length,
                                exercises: dayTraining.exercises.map((exercise, index) => ({
                                    name: exercise.name,
                                    completed: dayProgress.includes(index),
                                    series: exercise.series,
                                    reps: exercise.reps
                                }))
                            };
                        }
                    });

                    const completionRate = totalExercises > 0 ? Math.round((completedExercises / totalExercises) * 100) : 0;

                    const progressCard = document.createElement('div');
                    progressCard.className = 'progress-card';
                    progressCard.innerHTML = `
                        <h4>${student.nome}</h4>
                        <div class="progress-stats">
                            <div class="stat-item">
                                <div class="stat-value">${completionRate}%</div>
                                <div class="stat-label">Concluído</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${completedExercises}</div>
                                <div class="stat-label">de ${totalExercises}</div>
                            </div>
                        </div>
                        <div class="progress-details">
                            ${Object.keys(progressByDay).map(day => `
                                <div style="margin-bottom: 1rem;">
                                    <strong>${day.charAt(0).toUpperCase() + day.slice(1)}</strong>
                                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                                        ${progressByDay[day].exercises.map(exercise => `
                                            <div class="progress-item">
                                                <span class="${exercise.completed ? 'completed-exercise' : 'pending-exercise'}">
                                                    ${exercise.completed ? '✅' : '⭕'} ${exercise.name}
                                                </span>
                                                <span>${exercise.series}x${exercise.reps}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    progressGrid.appendChild(progressCard);
                }
            } catch (error) {
                showToast('Erro ao carregar progresso: ' + error.message, 'error');
            }
        }

        // ========================================
        // GERENCIAMENTO DE DADOS
        // ========================================

        async function exportData() {
            try {
                const [students, defaultTraining, allProgress] = await Promise.all([
                    getStudents(),
                    getDefaultTraining(),
                    getProgress()
                ]);

                // Buscar todos os treinos
                const allTrainings = {};
                for (const student of students) {
                    const training = await getTraining(student.id);
                    allTrainings[student.id] = training;
                }

                const data = {
                    students: students,
                    trainings: allTrainings,
                    progress: allProgress,
                    defaultTraining: defaultTraining,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `italo_ruan_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Dados exportados com sucesso!', 'success');
            } catch (error) {
                showToast('Erro ao exportar dados: ' + error.message, 'error');
            }
        }

        async function clearAllData() {
            if (confirm('ATENÇÃO: Você tem certeza que deseja limpar TODOS os dados (alunos, treinos, progresso)? Esta ação é irreversível.')) {
                try {
                    // Deletar todos os dados
                    await supabase.from('progresso').delete().neq('id', '00000000-0000-0000-0000-000000000000');
                    await supabase.from('treinos').delete().neq('id', '00000000-0000-0000-0000-000000000000');
                    await supabase.from('alunos').delete().neq('id', '00000000-0000-0000-0000-000000000000');
                    await supabase.from('treinos_padroes').delete().neq('id', '00000000-0000-0000-0000-000000000000');
                    
                    await loadStudents();
                    await loadStudentsForTrainingEdit();
                    await loadStudentsForProgress();
                    switchTab('dashboard');
                    showToast('Todos os dados foram limpos com sucesso!', 'success');
                } catch (error) {
                    showToast('Erro ao limpar dados: ' + error.message, 'error');
                }
            }
        }

        // ========================================
        // UTILITÁRIOS
        // ========================================

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        
    </script>
</body>
</html>