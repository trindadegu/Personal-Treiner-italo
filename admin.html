<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Painel de Administração - Acessoria Atlântida">
    <title>Painel de Administração - Acessoria Atlântida</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/000000/dumbbell.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="page-admin">

    <header class="admin-header">
        <div class="header-container">
            <div class="header-brand">
                <div class="header-brand-icon"><i class="fas fa-dumbbell"></i></div>
                <span>Painel Admin</span>
            </div>
            <div class="header-info">
                <button class="theme-toggle" data-action="toggle-theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <button class="btn-menu-toggle" data-action="toggle-sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="btn-logout" data-action="logout">
                    <i class="fas fa-sign-out-alt"></i> <span>Sair</span>
                </button>
            </div>
        </div>
    </header>

    <div class="admin-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <button class="nav-item active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button class="nav-item" data-tab="students"><i class="fas fa-users"></i> Alunos</button>
                <button class="nav-item" data-tab="edit-training"><i class="fas fa-edit"></i> Editar Treino Aluno</button>
                <button class="nav-item" data-tab="default-trainings"><i class="fas fa-clipboard-list"></i> Treinos Padrão</button>
                <button class="nav-item" data-tab="progress"><i class="fas fa-chart-line"></i> Progresso dos Alunos</button>
                <button class="nav-item nav-item-checkin" data-tab="checkins"><i class="fas fa-map-marker-alt"></i> Check-ins</button>
                <button class="nav-item" data-tab="settings"><i class="fas fa-cog"></i> Configurações</button>
            </nav>
        </aside>

        <main class="main-content">

            <!-- Dashboard -->
            <section class="tab-content active" id="dashboard">
                <div class="section-header"><h2>Dashboard</h2></div>
                <div class="treinos-container">
                    <p>Bem-vindo ao Painel de Administração. Use o menu lateral para gerenciar alunos e treinos.</p>
                    <p>Total de Alunos Cadastrados: <strong id="totalStudents">0</strong></p>
                </div>
            </section>

            <!-- Alunos -->
            <section class="tab-content" id="students">
                <div class="section-header">
                    <h2>Gerenciar Alunos</h2>
                    <button class="btn btn-primary" data-action="open-add-student-modal"><i class="fas fa-user-plus"></i> Adicionar Aluno</button>
                </div>
                <div class="students-container">
                    <div class="students-grid" id="studentsGrid"></div>
                </div>
            </section>

            <!-- Editar Treino Aluno -->
            <section class="tab-content" id="edit-training">
                <div class="section-header"><h2>Editar Treino do Aluno</h2></div>
                <div class="edit-training-container">
                    <div class="form-group">
                        <label for="studentToEditTraining">Selecione o Aluno:</label>
                        <select id="studentToEditTraining" class="form-input" name="studentToEditTraining">
                            <option value="">-- Selecione um Aluno --</option>
                        </select>
                    </div>
                    <div id="trainingEditorContainer" style="display: none;">
                        <div class="days-tabs" id="daysTabs"></div>
                        <div class="training-editor">
                            <h3 id="currentDayTitle">Treino de Segunda</h3>
                            <div class="focus-area-group">
                                <label for="focusArea">Área de Foco:</label>
                                <input type="text" id="focusArea" name="focusArea" class="form-input" placeholder="Ex: PEITO + TRÍCEPS + OMBRO" autocomplete="off">
                            </div>
                            <div class="exercises-editor">
                                <h4>Exercícios:</h4>
                                <div class="table-container">
                                    <table class="exercises-table">
                                        <thead><tr><th width="40%">Exercício</th><th width="15%">Séries</th><th width="15%">Repetições</th><th width="25%">Link do Vídeo</th><th width="5%"></th></tr></thead>
                                        <tbody id="exercisesTableBody"></tbody>
                                    </table>
                                </div>
                                <button class="btn btn-secondary" data-action="add-exercise-row"><i class="fas fa-plus"></i> Adicionar Exercício</button>
                            </div>
                            <div class="editor-actions" style="margin-top: 2rem;">
                                <button class="btn btn-primary" data-action="save-student-training"><i class="fas fa-save"></i> Salvar Treino</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Treinos Padrão -->
            <section class="tab-content" id="default-trainings">
                <div class="section-header">
                    <h2>Treinos Padrão</h2>
                    <button class="btn btn-primary" data-action="apply-default-to-all"><i class="fas fa-users"></i> Aplicar a Todos</button>
                    <button class="btn btn-secondary" data-action="apply-default-to-specific"><i class="fas fa-user-check"></i> Aplicar a Aluno Específico</button>
                </div>
                <div class="edit-training-container">
                    <div class="days-tabs" id="defaultDaysTabs"></div>
                    <div class="training-editor">
                        <h3 id="defaultCurrentDayTitle">Treino Padrão - Segunda</h3>
                        <div class="focus-area-group">
                            <label for="defaultFocusArea">Área de Foco:</label>
                            <input type="text" id="defaultFocusArea" name="defaultFocusArea" class="form-input" placeholder="Ex: PEITO + TRÍCEPS + OMBRO" autocomplete="off">
                        </div>
                        <div class="exercises-editor">
                            <h4>Exercícios:</h4>
                            <div class="table-container">
                                <table class="exercises-table">
                                    <thead><tr><th width="40%">Exercício</th><th width="15%">Séries</th><th width="15%">Repetições</th><th width="25%">Link do Vídeo</th><th width="5%"></th></tr></thead>
                                    <tbody id="defaultExercisesTableBody"></tbody>
                                </table>
                            </div>
                            <button class="btn btn-secondary" data-action="add-default-exercise-row"><i class="fas fa-plus"></i> Adicionar Exercício</button>
                        </div>
                        <div class="editor-actions" style="margin-top: 2rem;">
                            <button class="btn btn-primary" data-action="save-default-training"><i class="fas fa-save"></i> Salvar Treino Padrão</button>
                            <button class="btn btn-warning" data-action="load-predefined-training"><i class="fas fa-magic"></i> Carregar Treino Pré-definido</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progresso -->
            <section class="tab-content" id="progress">
                <div class="section-header"><h2>Progresso dos Alunos</h2></div>
                <div class="progress-container">
                    <div class="student-selector">
                        <label for="studentProgressSelect">Selecione o Aluno:</label>
                        <select id="studentProgressSelect" class="form-input" name="studentProgressSelect">
                            <option value="">-- Todos os Alunos --</option>
                        </select>
                    </div>
                    <div class="progress-grid" id="progressGrid"></div>
                </div>
            </section>

            <!-- ============================== CHECK-INS ============================== -->
            <section class="tab-content" id="checkins">
                <div class="section-header">
                    <h2><i class="fas fa-map-marker-alt" style="color:var(--primary-color);margin-right:.4rem;"></i>Check-ins dos Alunos</h2>
                    <div class="checkin-header-actions">
                        <select id="checkinStudentFilter" class="form-input checkin-filter-select">
                            <option value="">— Todos os alunos —</option>
                        </select>
                        <button class="btn btn-secondary" data-action="export-checkins">
                            <i class="fas fa-file-export"></i> Exportar CSV
                        </button>
                        <button class="btn btn-danger" data-action="clear-checkins">
                            <i class="fas fa-trash-alt"></i> Limpar
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="checkin-stats-row">
                    <div class="checkin-stat-card">
                        <div class="checkin-stat-icon"><i class="fas fa-map-pin"></i></div>
                        <div>
                            <div class="checkin-stat-value" id="statTotalCheckins">0</div>
                            <div class="checkin-stat-label">Total de Check-ins</div>
                        </div>
                    </div>
                    <div class="checkin-stat-card">
                        <div class="checkin-stat-icon ci-green"><i class="fas fa-user-check"></i></div>
                        <div>
                            <div class="checkin-stat-value" id="statActiveStudents">0</div>
                            <div class="checkin-stat-label">Alunos com check-in</div>
                        </div>
                    </div>
                    <div class="checkin-stat-card">
                        <div class="checkin-stat-icon ci-yellow"><i class="fas fa-dumbbell"></i></div>
                        <div>
                            <div class="checkin-stat-value checkin-stat-value--sm" id="statTopGym">—</div>
                            <div class="checkin-stat-label">Academia mais visitada</div>
                        </div>
                    </div>
                    <div class="checkin-stat-card">
                        <div class="checkin-stat-icon ci-red"><i class="fas fa-calendar-day"></i></div>
                        <div>
                            <div class="checkin-stat-value checkin-stat-value--sm" id="statLastCheckin">—</div>
                            <div class="checkin-stat-label">Último check-in</div>
                        </div>
                    </div>
                </div>

                <!-- Mapa -->
                <div class="checkin-map-card">
                    <div class="checkin-map-header">
                        <span><i class="fas fa-map"></i> Mapa de Check-ins</span>
                        <div class="checkin-map-legend">
                            <span><span class="legend-dot" style="background:#1e40af;"></span>Aluno</span>
                            <span><span class="legend-dot" style="background:#dc2626;"></span>Academia</span>
                        </div>
                    </div>
                    <div id="adminMap"></div>
                </div>

                <!-- Tabela histórico -->
                <div class="checkin-table-card">
                    <div class="checkin-table-header">
                        <h3><i class="fas fa-history"></i> Histórico detalhado</h3>
                    </div>
                    <div style="overflow-x:auto;">
                        <table class="checkin-table" id="checkinTable">
                            <thead>
                                <tr>
                                    <th>Aluno</th>
                                    <th>Academia encontrada</th>
                                    <th>Endereço</th>
                                    <th>Distância</th>
                                    <th>Data / Hora</th>
                                </tr>
                            </thead>
                            <tbody id="checkinTableBody">
                                <tr>
                                    <td colspan="5" class="checkin-empty">
                                        <i class="fas fa-map-marked-alt"></i>
                                        <p>Nenhum check-in registrado ainda.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            <!-- ============================== FIM CHECK-INS ============================== -->

            <!-- Configurações -->
            <section class="tab-content" id="settings">
                <div class="section-header"><h2>Configurações</h2></div>
                <div class="settings-container">
                    <div class="settings-box">
                        <h3>Credenciais de Admin</h3>
                        <div class="form-group">
                            <label for="adminUserSetting">Usuário:</label>
                            <input type="text" id="adminUserSetting" name="adminUserSetting" class="form-input" readonly autocomplete="username">
                        </div>
                        <div class="form-group">
                            <label for="adminPasswordSetting">Nova Senha:</label>
                            <input type="password" id="adminPasswordSetting" name="adminPasswordSetting" class="form-input" placeholder="Deixe em branco para manter a atual" autocomplete="new-password">
                        </div>
                        <button class="btn btn-primary" data-action="save-admin-settings"><i class="fas fa-save"></i> Salvar Configurações</button>
                    </div>
                    <div class="settings-box">
                        <h3>Gerenciamento de Dados</h3>
                        <p>Exportar ou limpar todos os dados de alunos e treinos.</p>
                        <button class="btn btn-warning" data-action="export-data"><i class="fas fa-file-export"></i> Exportar Dados</button>
                        <button class="btn btn-danger" data-action="clear-all-data"><i class="fas fa-trash-alt"></i> Limpar Todos os Dados</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Aluno -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">Adicionar Aluno</h2>
                <button class="modal-close" data-action="close-modal" data-modal-id="studentModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="studentFormModal">
                    <input type="hidden" id="studentIdModal" name="studentIdModal">
                    <div class="form-group">
                        <label for="studentNameModal">Nome do Aluno:</label>
                        <input type="text" id="studentNameModal" name="studentNameModal" class="form-input" required autocomplete="off">
                    </div>
                    <button type="submit" class="btn btn-primary" id="studentModalSubmit">Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>
    <script src="admin.js"></script>
</body>
</html>